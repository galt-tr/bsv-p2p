import { Validation as V, CreateActionArgs, WalletClient } from '@bsv/sdk'
import { specOpThrowReviewActions } from '../../src/sdk/types'
import { WalletError } from '../../src/sdk/WalletError'
import { WERR_REVIEW_ACTIONS } from '../../src/sdk/WERR_errors'
import { WalletErrorFromJson } from '../../src/sdk'

describe('WERR.man tests', () => {
  jest.setTimeout(99999999)

  test('0 WERR_REVIEW_ACTIONS via WalletClient', async () => {
    const wallet = new WalletClient('auto', '0.WERR.man.test')

    const args: CreateActionArgs = {
      labels: [specOpThrowReviewActions],
      description: 'must throw'
    }
    const vargs = V.validateCreateActionArgs(args)

    try {
      const r = await wallet.createAction(args)
      expect(true).toBe(false)
    } catch (eu: unknown) {
      const e = WalletError.fromUnknown(eu) as WERR_REVIEW_ACTIONS
      expect(e.code).toBe('WERR_REVIEW_ACTIONS')
      expect(e.reviewActionResults).toBeTruthy()
    }
  })

  test('1', async () => {
    const s = `{\"isError\":true,\"name\":\"WERR_REVIEW_ACTIONS\",\"reviewActionResults\":[{\"txid\":\"344556f1c428367689e09e29aa4dc7cfe755db1fab5cf7c1cf8d1f99b507004b\",\"status\":\"doubleSpend\",\"competingTxs\":[\"344556f1c428367689e09e29aa4dc7cfe755db1fab5cf7c1cf8d1f99b507004b\"],\"competingBeef\":[1,0,190,239,1,254,12,52,25,0,3,2,2,2,13,153,15,202,45,179,254,102,34,161,222,144,207,214,224,219,57,76,176,248,213,137,238,7,63,67,204,253,45,62,70,190,3,0,206,69,142,120,152,200,85,221,140,68,16,34,144,39,29,181,67,66,245,76,24,46,209,253,246,204,133,193,175,188,98,241,2,0,0,119,165,81,236,153,173,143,252,69,138,209,229,97,189,36,123,84,160,234,127,63,185,82,5,26,106,157,73,26,107,32,100,1,0,143,243,215,201,227,2,63,39,103,57,216,42,131,190,76,56,216,43,104,59,7,4,174,137,191,49,49,128,249,252,45,42,2,0,0,25,6,223,99,50,23,119,231,67,155,160,205,224,45,74,194,190,202,18,106,135,17,234,165,66,245,89,135,90,255,10,227,1,0,35,96,209,29,146,83,58,174,231,36,40,57,137,94,136,75,149,86,89,160,195,121,92,180,37,191,31,187,23,71,219,209,2,1,0,0,0,2,1,247,147,92,34,59,244,55,220,70,138,231,75,160,174,137,68,202,34,151,142,102,170,47,246,106,0,25,152,90,245,197,0,0,0,0,106,71,48,68,2,32,23,143,242,5,200,252,85,12,167,137,194,54,96,107,40,141,240,219,145,62,182,133,119,224,94,146,94,249,214,213,212,121,2,32,15,130,24,137,152,12,86,54,141,67,39,178,80,29,110,48,77,114,212,69,237,139,89,152,246,124,138,91,19,32,71,43,65,33,3,16,229,154,223,195,210,19,58,106,26,124,66,99,139,137,43,164,213,109,60,35,235,32,30,122,36,252,12,131,190,69,63,255,255,255,255,1,247,147,92,34,59,244,55,220,70,138,231,75,160,174,137,68,202,34,151,142,102,170,47,246,106,0,25,152,90,245,197,2,0,0,0,107,72,48,69,2,33,0,154,55,50,224,237,75,147,58,95,164,173,104,149,13,24,125,198,35,126,194,134,91,150,238,179,25,192,213,136,196,51,66,2,32,98,84,153,139,248,106,241,122,65,180,241,124,30,233,140,74,172,74,217,165,129,143,127,156,49,230,34,46,188,15,28,52,65,33,2,146,89,63,53,57,196,48,37,118,17,182,193,201,75,44,105,67,181,136,23,25,104,127,48,146,231,88,99,197,53,56,239,255,255,255,255,2,225,3,0,0,0,0,0,0,25,118,169,20,255,161,196,19,38,201,6,21,136,26,207,151,137,162,75,232,58,201,53,88,136,172,1,0,0,0,0,0,0,0,25,118,169,20,39,140,42,205,54,197,3,247,165,173,16,224,138,193,127,34,191,29,126,7,136,172,0,0,0,0,1,0,1,0,0,0,1,13,153,15,202,45,179,254,102,34,161,222,144,207,214,224,219,57,76,176,248,213,137,238,7,63,67,204,253,45,62,70,190,0,0,0,0,106,71,48,68,2,32,113,14,233,125,141,249,154,234,138,195,178,164,149,171,255,63,165,28,128,191,230,247,66,128,150,223,65,199,233,39,23,251,2,32,80,77,229,88,242,236,59,27,87,164,79,120,131,240,100,247,182,28,231,200,43,86,4,88,118,214,123,86,89,234,15,220,65,33,2,126,31,155,113,109,251,248,50,61,159,13,216,133,12,125,72,157,20,95,38,54,244,202,14,140,141,176,184,127,210,62,36,255,255,255,255,3,42,0,0,0,0,0,0,0,25,118,169,20,56,12,202,72,139,24,243,136,130,254,20,130,110,109,96,207,112,30,168,123,136,172,1,0,0,0,0,0,0,0,25,118,169,20,70,66,47,177,97,74,57,246,237,66,211,206,113,253,228,175,14,128,182,53,136,172,181,3,0,0,0,0,0,0,25,118,169,20,168,166,193,185,78,43,31,133,215,58,172,227,98,32,56,171,116,85,185,171,136,172,0,0,0,0,0]}],\"sendWithResults\":[{\"txid\":\"344556f1c428367689e09e29aa4dc7cfe755db1fab5cf7c1cf8d1f99b507004b\",\"status\":\"failed\"}],\"txid\":\"344556f1c428367689e09e29aa4dc7cfe755db1fab5cf7c1cf8d1f99b507004b\",\"tx\":[1,1,1,1,75,0,7,181,153,31,141,207,193,247,92,171,31,219,85,231,207,199,77,170,41,158,224,137,118,54,40,196,241,86,69,52,1,0,190,239,1,254,12,52,25,0,3,2,2,2,13,153,15,202,45,179,254,102,34,161,222,144,207,214,224,219,57,76,176,248,213,137,238,7,63,67,204,253,45,62,70,190,3,0,206,69,142,120,152,200,85,221,140,68,16,34,144,39,29,181,67,66,245,76,24,46,209,253,246,204,133,193,175,188,98,241,2,0,0,119,165,81,236,153,173,143,252,69,138,209,229,97,189,36,123,84,160,234,127,63,185,82,5,26,106,157,73,26,107,32,100,1,0,143,243,215,201,227,2,63,39,103,57,216,42,131,190,76,56,216,43,104,59,7,4,174,137,191,49,49,128,249,252,45,42,2,0,0,25,6,223,99,50,23,119,231,67,155,160,205,224,45,74,194,190,202,18,106,135,17,234,165,66,245,89,135,90,255,10,227,1,0,35,96,209,29,146,83,58,174,231,36,40,57,137,94,136,75,149,86,89,160,195,121,92,180,37,191,31,187,23,71,219,209,2,1,0,0,0,2,1,247,147,92,34,59,244,55,220,70,138,231,75,160,174,137,68,202,34,151,142,102,170,47,246,106,0,25,152,90,245,197,0,0,0,0,106,71,48,68,2,32,23,143,242,5,200,252,85,12,167,137,194,54,96,107,40,141,240,219,145,62,182,133,119,224,94,146,94,249,214,213,212,121,2,32,15,130,24,137,152,12,86,54,141,67,39,178,80,29,110,48,77,114,212,69,237,139,89,152,246,124,138,91,19,32,71,43,65,33,3,16,229,154,223,195,210,19,58,106,26,124,66,99,139,137,43,164,213,109,60,35,235,32,30,122,36,252,12,131,190,69,63,255,255,255,255,1,247,147,92,34,59,244,55,220,70,138,231,75,160,174,137,68,202,34,151,142,102,170,47,246,106,0,25,152,90,245,197,2,0,0,0,107,72,48,69,2,33,0,154,55,50,224,237,75,147,58,95,164,173,104,149,13,24,125,198,35,126,194,134,91,150,238,179,25,192,213,136,196,51,66,2,32,98,84,153,139,248,106,241,122,65,180,241,124,30,233,140,74,172,74,217,165,129,143,127,156,49,230,34,46,188,15,28,52,65,33,2,146,89,63,53,57,196,48,37,118,17,182,193,201,75,44,105,67,181,136,23,25,104,127,48,146,231,88,99,197,53,56,239,255,255,255,255,2,225,3,0,0,0,0,0,0,25,118,169,20,255,161,196,19,38,201,6,21,136,26,207,151,137,162,75,232,58,201,53,88,136,172,1,0,0,0,0,0,0,0,25,118,169,20,39,140,42,205,54,197,3,247,165,173,16,224,138,193,127,34,191,29,126,7,136,172,0,0,0,0,1,0,1,0,0,0,1,13,153,15,202,45,179,254,102,34,161,222,144,207,214,224,219,57,76,176,248,213,137,238,7,63,67,204,253,45,62,70,190,0,0,0,0,106,71,48,68,2,32,113,14,233,125,141,249,154,234,138,195,178,164,149,171,255,63,165,28,128,191,230,247,66,128,150,223,65,199,233,39,23,251,2,32,80,77,229,88,242,236,59,27,87,164,79,120,131,240,100,247,182,28,231,200,43,86,4,88,118,214,123,86,89,234,15,220,65,33,2,126,31,155,113,109,251,248,50,61,159,13,216,133,12,125,72,157,20,95,38,54,244,202,14,140,141,176,184,127,210,62,36,255,255,255,255,3,42,0,0,0,0,0,0,0,25,118,169,20,56,12,202,72,139,24,243,136,130,254,20,130,110,109,96,207,112,30,168,123,136,172,1,0,0,0,0,0,0,0,25,118,169,20,70,66,47,177,97,74,57,246,237,66,211,206,113,253,228,175,14,128,182,53,136,172,181,3,0,0,0,0,0,0,25,118,169,20,168,166,193,185,78,43,31,133,215,58,172,227,98,32,56,171,116,85,185,171,136,172,0,0,0,0,0],\"noSendChange\":[\"344556f1c428367689e09e29aa4dc7cfe755db1fab5cf7c1cf8d1f99b507004b.0\"]}`
    const o = JSON.parse(s)
    const e = WalletErrorFromJson(o)
    expect(e instanceof WERR_REVIEW_ACTIONS).toBe(true)
  })
})
