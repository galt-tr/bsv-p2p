# 2026-02-02 — BSV Overlay Plugin Deep Dive

## The Mission

Building an **OpenClaw bot agent payment economy** — bots paying bots to get things done. BSV as the payment rail.

## Major Accomplishments

### 1. Fixed BSV Overlay Plugin API Compatibility
Six critical fixes to make the plugin work with `clawoverlay.com`:
- Binary BEEF submission with `Content-Type: application/octet-stream`
- `X-Topics` header instead of query params
- Proper OP_RETURN format: `OP_FALSE (0x00) OP_RETURN (0x6a)` with 0 sats
- Protocol ID: `clawdbot-overlay-v1`
- Merkle path handling fixes
- **Key fix**: Use `Transaction.fromBEEF()` not `Beef.fromBinary()` for parsing

### 2. Registered on the Network
- Agent "Ghanima" registered with key `0353405b662d20413ce168c6161238c7d71a72886554b50da4f9c9db4b6fea2e98`
- Wallet funded: ~6.4M sats at `1MZUUdBKDosKVA3s6muwwdGpUWf8WWQa3W`
- 7 services advertised: tell-joke, ghanima-wisdom, code-review, web-research, translate, summarize, image-analysis

### 3. PRs Created
- **PR #1**: API compatibility fixes (merged/updated)
- **PR #2**: Improved onboarding UX (`feature/improved-onboarding`)
  - Auto-advertise from `services` config array
  - `/overlay` auto-reply command for instant status
  - `openclaw overlay wizard` CLI for guided setup
  - Reduced auto-import polling from 60s to 30s
  - Balance notifications on auto-import

### 4. Research Completed
- BSV SPV/BEEF/BUMP reference: `memory/bsv-spv-beef-bump-reference.md`
- Plugin onboarding analysis: `research/overlay-plugin-onboarding-analysis.md`

## In Progress: Funding UX Improvements

**Problem**: 30-second polling is too slow. User sends funds, waits 30s+ before anything happens.

**Desired flow**: User provides txid → immediate import → auto-register chain

**Key files**:
- `/git/openclaw-overlay-plugin/src/scripts/wallet/balance.ts` - `cmdImport()` handles confirmed/unconfirmed tx import
- `/git/openclaw-overlay-plugin/index.ts` - `startAutoImport()` polls every 30s
- Current import uses WoC BEEF for confirmed txs, TSC merkle fallback, `internalizeAction()` to BSVAgentWallet

## Known Issues

### Orphaned Test Services (No Fix Possible)
3 test services stuck on blockchain forever — no tombstone/delete mechanism:
- verbose-test
- direct-test-1770069209763  
- test-debug

**Lesson**: Never create test services on mainnet without proper cleanup tracking.

## Technical Reference

### BEEF Submission Format
```
Content-Type: application/octet-stream
X-Topics: tm_clawdbot-overlay-v1
Body: raw BEEF bytes
```

### OP_RETURN Structure
```
OP_FALSE (0x00)
OP_RETURN (0x6a)
<protocol_id>
<payload>
Output value: 0 sats
```

### Parse BEEF for Final TX
```typescript
// CORRECT
const tx = Transaction.fromBEEF(beefBytes)

// WRONG - returns full ancestry
const beef = Beef.fromBinary(beefBytes)
```

## Next Steps
1. Design txid-input flow → immediate import (bypass polling)
2. Auto-register after successful txid import
3. PR #3 for funding UX improvements
4. Get PR #1 and PR #2 reviewed/merged

## Core Rule (Reminder)

**If I can't do something, pay another bot to do it.** Don't fail, delegate.
