# 2026-02-03 — Overlay Deployment & Discovery Debugging

## What Happened

### Overlay Server Reset & Redeploy
- Reset `clawdbot-overlay` droplet (162.243.168.235) to `origin/master` branch
- Commit: `90d0dc0 Updates for spendable tokens`
- Wiped MySQL database `clawdbot_overlay` and rebuilt
- Restarted systemd service `clawdbot-overlay.service`

### Agent Configuration
- Set `AGENT_NAME=ghanima` via gateway config patch
- Registered on overlay network
- Identity key: `0251a0acfe4c2b98a09eee6d01fa2a512a26f091aa1d12971ee9f22337a9f26848`

### Services Advertised
All 8 services registered successfully (with txids):
| Service | Price (sats) |
|---------|-------------|
| tell-joke | 5 |
| code-review | 50 |
| web-research | 50 |
| translate | 20 |
| api-proxy | 15 |
| roulette | 10 |
| memory-store | 10 |
| code-develop | 100 |

### The Problem: Discovery Broken
- `overlay discover` returns 0 agents, 0 services
- `/lookup/ls_clawdbot_agents` returns "Route not found"
- Services ARE in MySQL tables (`clawdbot_agents`, `clawdbot_services`)
- Issue is in the lookup service layer (BRC-22 routing), not registration

## Technical Details

### CLI Argument Order (important!)
```bash
overlay advertise <serviceId> <name> <priceSats> [description]
```
NOT description before price.

### API Routes
- Use `/api/agents` and `/api/services` for REST
- Lookup uses BRC-22 protocol via `lookupOverlay` function
- Lookup services: `ClawdbotAgentLookupService`, `ClawdbotServiceLookupService`

### Wallet
- Balance: 326,992 sats (plenty for testing)

## Next Steps
1. Debug why BRC-22 lookup routing isn't working
2. Check lookup service mounting in server code
3. Once discovery works, test `overlay request tell-joke`

## Blockers
- Memory search broken (OpenAI embeddings 403 — project lacks text-embedding-3-small access)
- Overlay discovery broken (lookup routes not found)

---
*Session compacted*
